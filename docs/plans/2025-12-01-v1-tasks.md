# router-hosts v1.0 Implementation Tasks

**Date:** 2025-12-01
**Status:** Active
**Related:** [v1.0 Design Document](2025-12-01-router-hosts-v1-design.md)

This document tracks remaining implementation tasks for v1.0 release.

## Proto File Alignment

Proto file updated to match v1.0 design. See completed tasks below.

### Follow-on Tasks

| Task | Description | Priority | Status |
|------|-------------|----------|--------|
| ULID versioning | Store actual ULIDs as versions in event store (currently uses event_version as string) | High | TODO |
| Version check on update | Server returns ABORTED when expected_version doesn't match | High | TODO |
| Import conflict modes | Implement "replace" and "strict" modes (currently stubbed) | Medium | TODO |

### Implementation Notes

**Optimistic Concurrency:**
- `GetHost` response includes current version
- `UpdateHost` request includes expected version
- Server returns `ABORTED` if version mismatch
- Client shows diff and prompts for retry (or fails with `--non-interactive`)

**Version Format:**
- Proto uses `string version` (ULID format)
- Current implementation converts `event_version` (i64) to string as interim
- Full implementation should generate new ULID on each state change

## Client CLI

| Task | Description | Priority | Status |
|------|-------------|----------|--------|
| CLI structure | Implement subcommand groups (host, snapshot, config) | High | TODO |
| Host commands | add, get, update, delete, list, search | High | TODO |
| Snapshot commands | create, list, rollback, delete | High | TODO |
| Import/export | host import, host export with format flags | High | TODO |
| Config precedence | CLI > env vars > config file | High | TODO |
| Conflict handling | Interactive prompt with diff, --non-interactive flag | Medium | TODO |
| Output formats | table, json, csv output | Medium | TODO |
| Client config | Parse ~/.config/router-hosts/client.toml | Medium | TODO |

## Server Features

| Task | Description | Priority | Status |
|------|-------------|----------|--------|
| Import RPC | Implement ImportHosts with conflict handling | High | TODO |
| Export RPC | Implement ExportHosts with format support | High | TODO |
| Snapshot retention | Enforce max_snapshots and max_age_days | Medium | TODO |
| ACME support | Automatic certificate management | Medium | TODO |
| Event monitoring | Log warning at 100K events | Low | TODO |

## Deployment

| Task | Description | Priority | Status |
|------|-------------|----------|--------|
| Dockerfile | Create production Dockerfile with Chainguard base | Medium | TODO |
| Systemd unit | Create router-hosts.service file | Low | TODO |
| Example configs | Server and client config examples | Low | TODO |

## Documentation

| Task | Description | Priority | Status |
|------|-------------|----------|--------|
| Proto/design sync | Verify proto matches design after updates | High | TODO |
| API documentation | Generate docs from proto comments | Low | TODO |
| Deployment guide | Step-by-step setup instructions | Low | TODO |

## Test Coverage

| Task | Description | Priority | Status |
|------|-------------|----------|--------|
| Proto alignment tests | Test version field and concurrency | High | TODO |
| Client CLI tests | Unit and integration tests for CLI | High | TODO |
| Import/export tests | Test conflict handling modes | High | TODO |
| Coverage check | Ensure â‰¥80% coverage maintained | High | TODO |

## Completed

Tasks marked complete should be moved here with completion date.

| Task | Completed | Notes |
|------|-----------|-------|
| Design document | 2025-12-01 | docs/plans/2025-12-01-router-hosts-v1-design.md |
| Event store | 2025-11-30 | DuckDB with CQRS |
| Host CRUD RPCs | 2025-11-30 | Add/Get/Update/Delete/List/Search |
| Snapshot RPCs | 2025-11-30 | Create/List/Rollback/Delete |
| Hosts file generation | 2025-11-30 | Atomic writes |
| Hooks | 2025-11-30 | Success/failure with timeout |
| mTLS | 2025-11-30 | Manual cert mode |
| Proto alignment | 2025-12-01 | Version field, expected_version, removed BulkAddHosts, updated ImportHosts |
