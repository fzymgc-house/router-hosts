# router-hosts v1.0 Implementation Tasks

**Date:** 2025-12-01
**Last Updated:** 2025-12-09
**Status:** v1.0 core features complete - All E2E tests passing
**Related:** [v1.0 Design Document](2025-12-01-router-hosts-v1-design.md)

> **Note:** Post-v1.0 enhancements tracked in GitHub Issues.
> Use `gh issue list` to see current work items.

## Current Status Summary

### Core Features
| Feature | Status | Notes |
|---------|--------|-------|
| Event store (DuckDB/CQRS) | ✅ Complete | 2025-11-30 |
| Host CRUD RPCs | ✅ Complete | Add/Get/Update/Delete/List/Search |
| Snapshot RPCs | ✅ Complete | Create/List/Rollback/Delete |
| Hosts file generation | ✅ Complete | Atomic writes |
| Post-edit hooks | ✅ Complete | Success/failure with timeout |
| mTLS authentication | ✅ Complete | Manual cert mode |
| Export RPC | ✅ Complete | PR #22, 2025-12-04 |
| Import RPC | ✅ Complete | PR #33, 2025-12-05 |
| Client CLI | ✅ Complete | PR #36, 2025-12-06 |
| E2E acceptance tests | ✅ Complete | PR #72, 2025-12-08 |

### E2E Test Status

**All 8 E2E tests passing** ✅

| Test Scenario | Status | Notes |
|--------------|--------|-------|
| initial_setup | ✅ Passing | First-time deployment workflow |
| auth_failures (2 tests) | ✅ Passing | mTLS security boundary testing |
| search_and_filter | ✅ Passing | Host search functionality |
| crud_workflow | ✅ Passing | Fixed in PR #75 |
| import_export_roundtrip | ✅ Passing | Fixed in PR #76 |
| disaster_recovery (2 tests) | ✅ Passing | Fixed in PR #79, re-enabled in PR #80 |

### Post-v1.0 Enhancements

**Status:** v1.0 core complete. Remaining items are enhancements and polish.

#### Refactoring & Code Quality
| Task | Issue | Description |
|------|-------|-------------|
| FileFormat enum for type safety | #77 | Introduce enum for file format handling |
| RollbackResult improvements | #68 | Add #[must_use] and PartialEq |
| Server test coverage | #67 | Improve snapshots.rs to 95% coverage |
| RAII env var cleanup | #39 | Test code cleanup |

#### Performance
| Task | Issue | Description |
|------|-------|-------------|
| Batch host operations in rollback | #66 | Reduce file regenerations |
| Lazy streaming for export | #23 | Memory-efficient export |
| Batch transaction optimization | #34 | Improve import performance |

#### Features
| Task | Issue | Description |
|------|-------|-------------|
| Track partial rollback failures | #65 | RollbackResult enhancements |
| Rollback atomicity improvements | #64 | Transaction support |
| TTY check for progress display | #40 | Client UX improvement |
| Client-side stream limits | #38 | Safety limits |
| --no-follow-symlinks flag | #37 | Import security |

#### Infrastructure
| Task | Issue | Description |
|------|-------|-------------|
| GHCR image pruning | #73 | Keep only last 3 builds |
| cargo audit in CI | #29 | Security scanning |
| Coverage reporting | #25 | Add to CI |

#### Documentation
| Task | Issue | Description |
|------|-------|-------------|
| CHANGELOG for v0.1.0 | #78 | Document breaking changes |
| Import chunk size docs | #42 | Document design choices |
| CSV format specs | #24 | Document field selection |
| Container deployment | #18 | Separate hosts file setup |
| Event compaction strategy | #20 | Document approach |

#### Dependency Management
| Task | Issue | Description |
|------|-------|-------------|
| dirs→directories migration | #41 | Consider migration |

#### Future Features (Low Priority)
| Task | Issue | Description |
|------|-------|-------------|
| ACME support | #15 | Automatic certificate management |
| Event monitoring | #16 | Log warning at 100K events |
| CI security scanning | #29 | Add cargo audit |
| Coverage reporting | #25 | Add to CI |

### Client CLI Enhancements (Post-v1.0)
Issues created from PR #36 code review:
- #37: `--no-follow-symlinks` flag
- #38: Client-side stream limits
- #39: RAII env var cleanup in tests
- #40: TTY check for progress display
- #41: Consider dirs→directories migration
- #42: Document chunk size choice

### Documentation (Low Priority)
| Task | Issue | Description |
|------|-------|-------------|
| CSV format specs | #24 | Document field selection |
| Container deployment | #18 | Separate hosts file setup |
| ACME/mTLS interaction | #19 | Certificate management docs |
| Event compaction strategy | #20 | Document compaction approach |

## Completed

| Task | Completed | PR/Notes |
|------|-----------|----------|
| Design document | 2025-12-01 | docs/plans/2025-12-01-router-hosts-v1-design.md |
| Event store | 2025-11-30 | DuckDB with CQRS |
| Host CRUD RPCs | 2025-11-30 | Add/Get/Update/Delete/List/Search |
| Snapshot RPCs | 2025-11-30 | Create/List/Rollback/Delete |
| Hosts file generation | 2025-11-30 | Atomic writes |
| Hooks | 2025-11-30 | Success/failure with timeout |
| mTLS | 2025-11-30 | Manual cert mode |
| Proto alignment | 2025-12-01 | PR #7 - Version field, expected_version |
| CI pipeline | 2025-12-01 | GitHub Actions with lint/test/review |
| ExportHosts RPC | 2025-12-04 | PR #22 - hosts/json/csv formats |
| Integration tests | 2025-12-04 | PR #21 - gRPC integration tests |
| ImportHosts RPC | 2025-12-05 | PR #33 - Bidirectional streaming |
| Import conflict modes | 2025-12-05 | PR #33 - Skip/replace/strict modes |
| Client CLI | 2025-12-06 | PR #36 - Complete CLI with all commands |
| ULID versioning | 2025-12-07 | PR #50 - Store ULIDs as event versions |
| Version check on update | 2025-12-08 | PR #46 - Optimistic concurrency control |
| Interactive conflict handling | 2025-12-08 | PR #51 - CLI diff display with retry |
| Snapshot retention | 2025-12-08 | PR #53 - Enforce max_snapshots and max_age |
| Version conflict tests | 2025-12-08 | PR #55 - Integration tests for retry flow |
| RollbackToSnapshot | 2025-12-08 | PR #63 - Snapshot rollback with pre-rollback backup |
| Snapshot/hooks coverage | 2025-12-08 | PR #59 - Tests for snapshots and hooks |
| E2E testing infrastructure | 2025-12-08 | PR #72 - Docker + testcontainers + mTLS + scenario tests |
| CLI JSON output bug fixes | 2025-12-09 | PRs #75, #76, #79 - Fixed JSON output for all commands |
| E2E disaster recovery tests | 2025-12-09 | PR #80 - Re-enabled all E2E tests (8/8 passing) |
