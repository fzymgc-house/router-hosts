# Router-Hosts Docker Compose Example
#
# Prerequisites:
#   1. Generate TLS certificates (see examples/generate-certs.sh)
#   2. Create config file from template: cp examples/server.toml.example config/server.toml
#   3. Create directories: mkdir -p config certs data
#
# Usage:
#   docker compose up -d
#
# Client connection:
#   router-hosts --server localhost:50051 \
#     --cert certs/client.pem \
#     --key certs/client-key.pem \
#     --ca certs/ca.pem \
#     list

services:
  router-hosts:
    image: ghcr.io/fzymgc-house/router-hosts:latest
    container_name: router-hosts-server
    restart: unless-stopped
    ports:
      - "50051:50051"
    volumes:
      # Server configuration (must not be world-writable)
      - ./config:/config:ro
      # TLS certificates for mTLS authentication
      - ./certs:/certs:ro
      # Persistent data: DuckDB database and generated hosts file
      - ./data:/data
    environment:
      # Logging level: trace, debug, info, warn, error
      RUST_LOG: info
    # Default command from Dockerfile (shown for reference):
    #   server --config /config/server.toml
    # Uncomment to override config path:
    # command: ["server", "--config", "/config/custom.toml"]
    healthcheck:
      # TCP port check using netcat (installed in container)
      test: ["CMD", "nc", "-z", "localhost", "50051"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

# Example with custom network for multi-container setups:
#
# networks:
#   dns-network:
#     driver: bridge
#
# services:
#   router-hosts:
#     networks:
#       - dns-network
#     ...
#
#   dnsmasq:
#     image: jpillora/dnsmasq
#     networks:
#       - dns-network
#     volumes:
#       - ./data/hosts:/etc/hosts.router-hosts:ro
#     ...
